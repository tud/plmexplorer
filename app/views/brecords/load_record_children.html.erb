<script type="text/javascript">
var id = "<%= @id %>";
var reftypes = "<%= @reftypes %>";
$(function(){
	$('#apply_button_children').click(function() {
		reftypes = "";
		$("#children_filters input[type='checkbox']").each( function() {
			if ($(this).is(':checked')) {
				if (reftypes == "") {
					reftypes = $(this).attr('value');
				} else {
					reftypes = reftypes + "," + $(this).attr('value');
				}
			}
		});
		var selected = $('#record_tabs > ul').tabs().data('selected.tabs');
		var url = '/<%= controller.controller_name %>/load_record_children?id=<%= @id %>&reftypes='+reftypes;
		$('#record_tabs > ul').tabs("url", selected, url);
		$('#record_tabs > ul').tabs("load", selected );
		return false;
	});
	$("#children_filters").checkbox({checked: "/images/fam/add.png", unchecked: "/images/fam/delete.png"});
});
</script>


<div>
<%
	arr_rectypes = @reftypes.split ","
	form_for :filter, :html => {:id => 'children_filters'} do |f|
		(filter_children @record.brectype).each do |filter|
			if arr_rectypes.include? filter
%>
				<input type="checkbox" name="children_filter" value="<%=filter%>" checked="checked"/><label><%=filter%></label>
<%
			elsif
%>
				<input type="checkbox" name="children_filter" value="<%=filter%>"/><label><%=filter%></label>
<%
			end
		end
%>
		&nbsp;&nbsp;<a href="#" id="apply_button_children" class="button ui-state-default ui-corner-all">Filter</a>
<%
	end
%>
</div>
<p></p>

<table id="childrenGrid" class="scroll"></table>
<div id="childrenPager" class="scroll"></div>

<script type="text/javascript">
$(function(){
	var centerWidth = pexLayout.cssWidth('center') - 90;
	$('#childrenGrid').jqGrid({
		url: '/brecords/grid_children',
		datatype: 'json',
		mtype: 'GET',
		colNames: ['id', 'Relationship', 'Item Type', 'Identifier', 'Bus Id', 'Rev', 'Status', 'Description', 'Qty'],
		colModel :[
			{name:'id',        index:'id',        hidden:true},
			{name:'breftype',  index:'breftype',  width:70},
			{name:'brectype',  index:'brectype',  width:50},
			{name:'name',      index:'brecname',  width:80},
			{name:'busid',     index:'cage_code', width:35, sortable:false},
			{name:'brecalt',   index:'brecalt',   width:30, sortable:false},
			{name:'breclevel', index:'breclevel', width:60}, 
			{name:'bdesc',     index:'bdesc',     width:250, sortable:false}, 
			{name:'bquantity', index:'bquantity', width:30, align:'center', sortable:false} ],
		rowNum: 20,
		rowList: [10,20,30,50,100],
		sortname: 'breftype,brectype,brecname',
		sortorder: 'asc',
		viewrecords: true,
		imgpath: grid_imgpath,
		height: '100%',
		width: centerWidth,
		pager: 'childrenPager',
		ondblClickRow: function(id) {
			if (id!=null) {
				$.history(id);
				$('#cRecord').load("<%= url_for(:controller => 'brecords', :action => 'load_record_base') %>",{id:id});
			}
			$('#record_content > ul').tabs('select', 0);
		},
		postData: {id: id, reftypes: reftypes}
	})
	.navGrid('#childrenPager', {refresh: false, edit: false, add: false, del: false, search: false})
});
</script>
